\ProvidesPackage{custom}

% -------------------------------------------------------------------
% 1. Character encoding & Fonts
% -------------------------------------------------------------------
\RequirePackage[T1]{fontenc}
\RequirePackage[utf8]{inputenc}
\RequirePackage{mathpazo}

% -------------------------------------------------------------------
% 2. Margins and spacing
% -------------------------------------------------------------------
% 1 inch margins (Industry Standard)
\RequirePackage[margin=1in]{geometry}
\RequirePackage{setspace}
\onehalfspacing

% -------------------------------------------------------------------
% 3. Colors
% -------------------------------------------------------------------
\RequirePackage{xcolor}
\definecolor{ghibli_palette_red}{RGB}{255, 92, 92}
\definecolor{ghibli_palette_gold}{RGB}{255, 215, 0}
\definecolor{ghibli_palette_deep_teal}{RGB}{59, 105, 120}
\definecolor{ghibli_palette_cream}{RGB}{249, 245, 227}
\definecolor{ghibli_palette_light_gray}{RGB}{218, 218, 218}
\definecolor{ghibli_palette_gray}{RGB}{108, 122, 142}
\definecolor{ghibli_palette_blue}{RGB}{143, 177, 233}
\definecolor{ghibli_palette_green}{RGB}{166, 215, 132}
\definecolor{ghibli_palette_muted_green}{RGB}{132, 165, 157}
\definecolor{ghibli_palette_warm_red}{RGB}{242, 132, 130}

% -------------------------------------------------------------------
% 4. Essential packages
% -------------------------------------------------------------------
\RequirePackage{graphicx}
\RequirePackage{amsmath}
\RequirePackage{amsthm}
\RequirePackage{amssymb}
\RequirePackage{subcaption}
\RequirePackage{booktabs}
\RequirePackage[ruled, vlined, linesnumbered]{algorithm2e}

% Bibliography (Load before hyperref)
\RequirePackage[style=authoryear, maxnames=3, maxbibnames=5, backend=biber]{biblatex}
\addbibresource{bibliography.bib}
\renewcommand*{\nameyeardelim}{\addcomma\space}

% Hyperref (Load last)
\RequirePackage{hyperref}

% -------------------------------------------------------------------
% 5. Link Configuration (FIXED)
% -------------------------------------------------------------------
% MOVED OUT of \AtBeginDocument to ensure Mac Preview sees the colors.
% Added pdfborder={0 0 0} to ensure Chrome doesn't draw magenta boxes.
\hypersetup{
    colorlinks=true,
    linkcolor=ghibli_palette_red,
    citecolor=ghibli_palette_deep_teal,
    urlcolor=ghibli_palette_deep_teal,
    pdfborder={0 0 0},      % Crucial for Chrome/Acrobat to hide boxes
    breaklinks=true         % Allows links to break across lines
}

% -------------------------------------------------------------------
% 6. Theorem environments setup
% -------------------------------------------------------------------
\theoremstyle{plain}
\newtheorem{proposition}{Proposition}
\newtheorem{assumption}{Assumption}
\newtheorem{theorem}{Theorem}
\newtheorem{lemma}{Lemma}
\newtheorem{corollary}{Corollary}
\newtheorem{definition}{Definition}
\newtheorem{remark}{Remark}

% -------------------------------------------------------------------
% 7. Appendix counter management
% -------------------------------------------------------------------
\RequirePackage{chngcntr}
\RequirePackage{apptools}
\AtAppendix{
    \counterwithin{proposition}{section}
    \counterwithin{assumption}{section}
    \counterwithin{theorem}{section}
    \counterwithin{lemma}{section}
    \counterwithin{corollary}{section}
    \counterwithin{definition}{section}
    \counterwithin{equation}{section}
}

% -------------------------------------------------------------------
% 8. Mathematical notation
% -------------------------------------------------------------------
\newcommand{\E}{\mathbb{E}}
\newcommand{\Var}{\mathrm{Var}}
\newcommand{\Cov}{\mathrm{Cov}}
\newcommand{\supp}{\mathrm{supp}}
\newcommand{\ubar}[1]{\text{\b{$#1$}}}

\endinput